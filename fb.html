<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoSinTV - Cricket | Football | Playing XI | Match Preview</title>
    <!-- Updated standard CDN for Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://web.cricfoot.net/favico.png' rel='icon' type='image/x-icon'/>
    
    <!-- CRITICAL FIX: Added /adsbygoogle.js to the source URL to ensure the AdSense library loads correctly -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5525538810839147" crossorigin="anonymous"></script>
    
    <style>
    /* --- CUSTOM CSS FOR LIGHT THEME FOTMOB STYLE (CENTERED LAYOUT) --- */
    
    body { 
        font-family: 'Poppins', sans-serif; 
        background-color: #f3f4f6; /* Light Gray Background (Default) */
        color: #1f2937; /* Dark Text (Default) */
    }

    /* Dark Mode Body Overrides */
    .dark body { 
        background-color: #111827; /* Very Dark Gray */
        color: #f3f4f6; /* Light Text */
    }
    
    .match-schedule-container { max-width: 1000px; margin: 0 auto; padding: 0 1rem 3rem; box-sizing: border-box; }
    
    .league-title {
        font-size: 1rem; font-weight: 700; margin: 20px auto 15px; 
        background: #1d4ed8; /* Primary Blue */ 
        color: white;
        border-radius: 8px; text-align: center; padding: 12px; 
        width: calc(100% - 1rem); max-width: 960px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    /* Match Card */
    .match-card {
        display: block; border-radius: 12px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb; 
        padding: 16px; margin: 16px auto; 
        background: #ffffff; /* Light Mode Background */
        width: calc(100% - 1rem); max-width: 960px; 
        transition: all 0.25s;
    }
    
    /* Dark Mode Match Card */
    .dark .match-card {
        background: #374151; /* Darker Card Background */
        border-color: #4b5563;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .match-card:hover { 
        box-shadow: 0 6px 14px rgba(0,0,0,0.15); /* Subtly increased shadow */
        border-color: #93c5fd;
    }
    .dark .match-card:hover {
        border-color: #60a5fa;
    }

    /* Content Layout */
    .match-card-content { display: flex; flex-direction: column; gap: 10px; }
    
    /* Key change: Team Layout for Centering */
    .match-row-teams { 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        width: 100%;
    }
    
    /* * Team Containers: Updated to use flex properties for better mobile responsiveness.
     * flex-grow: 1 ensures they fill available space.
     * min-width: 0 is critical to allow flex items to shrink below their content size.
     */
    .match-team { 
        flex-grow: 1; 
        flex-basis: 0;
        min-width: 0; /* Fixes mobile overflow issue */
        display: flex; 
        align-items: center; 
        gap: 10px; 
        flex-shrink: 1;
    }

    /* Home Team (Left): Pushed to the right edge of its container (closest to center) */
    .match-team.home {
        justify-content: flex-end; 
    }

    /* Away Team (Right): Pushed to the left edge of its container (closest to center) */
    .match-team.away {
        justify-content: flex-start;
    }

    /* Logo Styling (Position of logo is maintained relative to team name/center) */
    .match-team img { 
        width: 48px; height: 48px; 
        border-radius: 0; /* User Request: Remove all rounded corners */
        border: none; /* User Request: Remove all borders/square styling */
        flex-shrink: 0;
    }

    /* Team Name Ordering and Alignment (Text aligns toward center) */
    .match-team-name {
        font-size: 1.125rem; 
        font-weight: 700; 
        color: #1f2937; /* Light Mode Text Color */
        flex-grow: 1;
        /* Desktop: Truncate long names with "..." */
        white-space: nowrap; 
        overflow: hidden; 
        text-overflow: ellipsis; 
    }

    /* Dark Mode Team Name Color */
    .dark .match-team-name {
        color: #f3f4f6;
    }
    
    /* Home team name is placed to the left of the logo and aligns right */
    .match-team.home .match-team-name { 
        order: -1; 
        text-align: right; 
    }
    
    /* Away team name is placed to the right of the logo and aligns left */
    .match-team.away .match-team-name { 
        order: 1; 
        text-align: left; 
    }

    /* Status/Center Element (Fixed width to maintain centering) */
    .match-center { 
        flex-shrink: 0; 
        min-width: 90px;
        text-align: center;
        display: flex; 
        flex-direction: column; 
        align-items: center;
    }
    
    /* Local Time Styling */
    .match-local-time {
        font-size: 0.875rem; 
        font-weight: 600;
        color: #4b5563; /* Light Mode Text Color */
        margin-bottom: 4px;
        letter-spacing: 0.025em;
    }

    /* Dark Mode Local Time Styling */
    .dark .match-local-time {
        color: #9ca3af;
    }

    /* Status Indicator (Pill style) */
    .match-status {
        font-size: 0.75rem !important; 
        font-weight: 700; 
        padding: 4px 8px;
        border-radius: 9999px; 
        display: inline-block;
        min-width: 60px; text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        letter-spacing: 0.05em;
        line-height: 1;
    }
    .match-status-countdown { background: #10b981; color: white; }
    .match-status-live {
        background: #ef4444; color: white; 
        animation: pulse 1.2s infinite;
    }
    .match-status-over { background: #6b7280; color: #ffffff; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

    /* Media Query for Mobile adjustments (Force wrap long names) */
    @media (max-width: 640px) {
        .match-team-name { 
            font-size: 0.875rem; /* Smaller font for better fit */
            /* Crucial changes to allow wrapping on mobile */
            white-space: normal; 
            overflow: visible; 
            text-overflow: clip; 
            line-height: 1.2; /* Tighter line spacing for two lines */
        } 
        .match-team img { width: 36px; height: 36px; }
        .match-center { min-width: 80px; }
        .match-card { padding: 12px; }
        .match-team { gap: 8px; } /* Slightly reduced gap */
    }

    /* Header and Footer styles (Light Theme Defaults) */
    header {
      position: fixed; top: 0; width: 100%; 
      background: white; /* Light Mode Header Background */
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 100;
    }

    /* Dark Mode Header */
    .dark header {
        background: #1f2937; /* Dark Header Background */
    }

    .header-container {
      max-width: 1000px; margin: 0 auto; padding: 0 1rem;
      height: 70px; display: flex; justify-content: space-between; align-items: center;
    }

    /* DMCA and Footer Section Styles */
    .dmca-section, .footer {
      max-width: 1000px; margin: 2rem auto; padding: 1.5rem; 
      background: #f8fafc; /* Light Mode Section Background */
      border-radius: 12px; text-align: center;
      color: inherit; /* Inherit text color from body (light mode: dark, dark mode: light) */
    }

    /* Dark Mode DMCA and Footer Sections */
    .dark .dmca-section, .dark .footer {
        background: #1f2937; /* Darker Blue-Gray Section Background */
    }

    /* Dark Mode Link Color Correction for Footer */
    .dark .footer a {
        color: #93c5fd; /* Lighter link color */
    }

    /* Toggle (Kept for functionality, but appearance defaults to off/light) */
    .toggle { position: relative; display: inline-block; width: 46px; height: 24px; }
    .toggle input { opacity: 0; width:0; height:0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background: #ccc; border-radius: 30px; transition: .4s;
    }
    .slider:before {
      position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px;
      background: white; border-radius: 50%; transition: .4s;
    }
    input:checked + .slider { background: #3b82f6; }
    input:checked + .slider:before { transform: translateX(22px); }
    </style>
    
</head>
<body class="bg-gray-100 text-gray-900">

<!-- Header and Logo -->
<header>
    <div class="header-container">
        <a href="https://www.yosin-tv.net/">
            <img src="https://web.cricfoot.net/logo.png" alt="YoSinTV" style="height:65px;">
        </a>
        <label class="toggle">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider"></span>
        </label>
    </div>
</header>

<main style="padding-top: 78px;">
    <!-- Removed hardcoded ad blocks. Ads are now programmatically inserted. -->
    
    <div class="match-schedule-container"> 
        <h2 class="league-title"> Upcoming Football Matches</h2>
        <div id="cricket-list" class="match-schedule-list">
            <!-- Match cards and interleaved mobile-only ads will be inserted here by JS -->
        </div>
    </div>

<!-- DMCA and Footer Sections -->
    <section class="dmca-section">
        <h2 class="text-2xl font-bold mb-3">YoSinTV - DMCA Notice</h2>
        <p class="text-sm leading-relaxed">YoSinTV Doesn't host any media content on it own Site. Our site visitors might use external or third parties services to show content, (Example: Embedding media from sites like Bet365, Dailymotion , Streamable etc ..) We Notify all copyright owners, to discover that the links and media shared by visitors and contained within this site are hosted somewhere else on the web or embedded from other various sites like above.</p>
    </section>

    <footer class="footer text-sm">
        <a href="#about" class="text-blue-600 hover:underline mx-2">About</a> •
        <a href="#contact" class="text-blue-600 hover:underline mx-2">Contact</a> •
        <a href="#privacy" class="text-blue-600 hover:underline mx-2">Privacy Policy</a>
    </footer>
</main>

<script>
    let allMatches = [];
    let updateIntervalId;

    // Dark Mode Logic (Kept for user's preference)
    const toggle = document.getElementById('darkModeToggle');
    // Set initial state
    const updateTheme = (isDark) => {
        if (isDark) {
             // We only need to toggle the 'dark' class here.
             // The rest of the styling is handled by the CSS using .dark prefix.
             document.body.classList.add('dark', 'bg-gray-900', 'text-gray-100');
             document.body.classList.remove('bg-gray-100', 'text-gray-900');
        } else {
             document.body.classList.remove('dark', 'bg-gray-900', 'text-gray-100');
             document.body.classList.add('bg-gray-100', 'text-gray-900');
        }
    };

    if (localStorage.getItem('darkMode') === 'true') {
        updateTheme(true);
        toggle.checked = true;
    } else {
        updateTheme(false);
    }
    
    toggle.addEventListener('change', () => {
        const isChecked = toggle.checked;
        updateTheme(isChecked);
        localStorage.setItem('darkMode', isChecked);
    });

    /**
     * Formats an ISO date string into a readable local time string (e.g., 6:30 PM).
     * This also removes any risk of displaying 'undefined'.
     */
    function formatMatchTime(isoString) {
        try {
            const date = new Date(isoString);
            if (isNaN(date)) return 'Time TBD';

            const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
            return new Intl.DateTimeFormat(undefined, timeOptions).format(date);
        } catch (e) {
            return 'Time TBD';
        }
    }

    /**
     * Updates the text content and class of the countdown/status elements only.
     * This runs every second to prevent continuous DOM re-rendering (flicker).
     */
    function updateCountdownDisplay() {
        const now = Date.now();
        
        document.querySelectorAll('.match-status').forEach(el => {
            const start = new Date(el.dataset.time).getTime();
            const duration = (parseInt(el.dataset.duration) || 2) * 3600000;
            const end = start + duration;

            if (now >= end) {
                // Match is Over (Final Time)
                el.textContent = 'FT';
                if (!el.classList.contains('match-status-over')) {
                     el.className = 'match-status match-status-over';
                }
            } else if (now >= start) {
                // Match is Live
                el.textContent = 'LIVE';
                if (!el.classList.contains('match-status-live')) {
                    el.className = 'match-status match-status-live';
                }
            } else {
                // Match is Upcoming (Countdown)
                const diff = start - now;
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                let countdownText = '';
                if (diff < 0) {
                     countdownText = 'Starting Soon';
                } else if (d > 0) {
                    countdownText = `${d}D ${h}H`;
                } else if (h > 0) {
                    countdownText = `${h}H ${m}M`;
                } else {
                    const s = Math.floor((diff % (1000 * 60)) / 1000);
                    countdownText = `${m}M ${s}S`;
                }
                
                el.textContent = countdownText;
                if (!el.classList.contains('match-status-countdown')) {
                    el.className = 'match-status match-status-countdown';
                }
            }
        });
    }

    // Generates the match card HTML
    function createCard(m) {
        // --- Added safe property access to prevent 'undefined' ---
        const detailsUrl = m.details_url || '#';
        const competition = m.competition || ''; // Use empty string as fallback
        const team1Name = m.team1 || 'Home Team TBD';
        const team2Name = m.team2 || 'Away Team TBD';
        
        const placeholderImg = "https://placehold.co/48x48/ccc/333?text=L";
        // Use safe fallback for logos as well
        const team1Logo = m.team1_logo || placeholderImg;
        const team2Logo = m.team2_logo || placeholderImg;
        
        const logoOnError = `this.onerror=null;this.src='${placeholderImg}';`;
        
        const localTime = formatMatchTime(m.start || m.match_time);

        // Conditional rendering of the competition header (Match Details text removed)
        // If competition is empty, the div is not rendered at all.
        const competitionHeader = competition ? 
            `<div class="match-header">${competition}</div>` : 
            '';

        const a = document.createElement('a');
        a.href = detailsUrl; // Use safe URL
        a.className = 'match-card';
        a.target = '_blank';
        a.dataset.time = m.start || m.match_time;
        a.dataset.duration = m.duration || 2;
        
        a.innerHTML = `
            <div class="match-card-content">
                <!-- Top Row: Competition/Match Date (Context) -->
                ${competitionHeader}

                <!-- Middle Row: Teams and Status (The main, centered row) -->
                <div class="match-row-teams">
                    <!-- Home Team (Left, Content aligned right) -->
                    <div class="match-team home">
                        <p class="match-team-name">${team1Name}</p>
                        <img src="${team1Logo}" alt="${team1Name}" onerror="${logoOnError}">
                    </div>
                    
                    <!-- Status/Center (Time above Countdown) -->
                    <div class="match-center">
                        <p class="match-local-time">${localTime}</p> 
                        <p class="match-status" data-time="${m.start || m.match_time}" data-duration="${m.duration || 2}">Loading...</p>
                    </div>

                    <!-- Away Team (Right, Content aligned left) -->
                    <div class="match-team away">
                        <img src="${team2Logo}" alt="${team2Name}" onerror="${logoOnError}">
                        <p class="match-team-name">${team2Name}</p>
                    </div>
                </div>
            </div>
        `;
        return a;
    }

    /**
     * Creates the mobile-only ad element with the user-specified slot ID.
     * UPDATED to use the 320x50 fixed size ad unit (slot 8381900703).
     */
    function createAdElement() {
        const adContainer = document.createElement('div');
        // 'block md:hidden' ensures it only displays on mobile screens (up to 768px).
        // Added flex justify-center to properly center the fixed 320px ad.
        adContainer.className = 'my-5 flex justify-center block md:hidden'; 
        adContainer.innerHTML = `
            <!-- Mobile Interleaved Ad Slot (320x50 - 8381900703) -->
            <ins class="adsbygoogle"
                 style="display:inline-block;width:320px;height:50px"
                 data-ad-client="ca-pub-5525538810839147"
                 data-ad-slot="8381900703"></ins>
        `;
        return adContainer;
    }

    // UPDATED: Inserts mobile ads after every 3rd card.
    function renderMatches() {
        const list = document.getElementById('cricket-list');
        list.innerHTML = ''; 
        
        allMatches.forEach((match, index) => {
            // 1. Append the match card
            list.appendChild(createCard(match));

            // 2. Check if it's the 3rd, 6th, 9th, etc. card, and not the last card
            if ((index + 1) % 3 === 0 && index < allMatches.length - 1) { 
                const adElement = createAdElement();
                list.appendChild(adElement);

                // Now, push the ad to AdSense so it can request content
                try {
                    (window.adsbygoogle = window.adsbygoogle || []).push({});
                } catch (e) {
                    console.error("AdSense push failed:", e);
                }
            }
        });
    }
    
    /**
     * Calculates sort priority, sorts the matches array, and renders the list once.
     * This function should only be called on initial load.
     */
    function sortAndInitialRender(matchesArray) {
        const now = Date.now();
        
        // 1. Calculate sorting priority and value
        allMatches = matchesArray.map(m => {
            const startTime = new Date(m.start || m.match_time).getTime();
            const duration = (parseInt(m.duration) || 2) * 3600000; 
            const endTime = startTime + duration;
    
            if (now >= startTime && now < endTime) {
                m.sortPriority = 1; // Live/In-Progress
                m.sortValue = startTime; 
            } else if (now < startTime) {
                m.sortPriority = 2; // Upcoming
                m.sortValue = startTime;
            } else {
                m.sortPriority = 3; // Finished
                m.sortValue = endTime;
            }
            return m;
        });
    
        // 2. Sort the array
        allMatches.sort((a, b) => {
            if (a.sortPriority !== b.sortPriority) return a.sortPriority - b.sortPriority;
            return a.sortValue - b.sortValue; 
        });
    
        // 3. Render the full match list structure once
        renderMatches(); 
    }

    // Loads data from the API and initiates rendering
    async function loadMatches() {
        if (updateIntervalId) clearInterval(updateIntervalId); 

        // UPDATED: Changed API endpoint to football.json
        const apiUrl = 'https://yosintv-api.pages.dev/api/football.json'; 
        const list = document.getElementById('cricket-list');
        // Removed explicit loading message for natural loading behavior
        list.innerHTML = ''; 

        try {
            const res = await fetch(apiUrl);
            if (!res.ok) {
                throw new Error(`API failed with status: ${res.status}.`);
            }
            
            const data = await res.json();
            let matchesArray = [];

            if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0]?.matches)) {
                matchesArray = data[0].matches;
            } else if (data && Array.isArray(data.matches)) {
                matchesArray = data.matches;
            } else if (Array.isArray(data)) {
                 matchesArray = data;
            } 

            if (matchesArray.length === 0) {
                list.innerHTML = '<p class="text-center text-xl font-semibold text-gray-500 py-10">No upcoming matches found.</p>';
                return;
            }
            
            // Initial sort and render
            sortAndInitialRender(matchesArray);
            
            // Start the non-flickering countdown timer (runs every second)
            updateCountdownDisplay();
            updateIntervalId = setInterval(updateCountdownDisplay, 1000);
            
        } catch (e) {
            console.error(`Error loading matches: ${e.message}`);
            list.innerHTML = '<p class="text-center text-xl font-semibold text-red-600 py-10">❌ Failed to load schedule. Check the API or your connection.</p>';
            return;
        }
    }


    document.addEventListener('DOMContentLoaded', loadMatches);
</script>
</body>
</html>
