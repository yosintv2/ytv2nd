<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoSinTV - Cricket | Football | Playing XI | Match Preview</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='/favico.png' rel='icon' type='image/x-icon'/>
    <style>
        /* --- ORIGINAL CSS PRESERVED --- */
        body { font-family: 'Poppins', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .dark body { background-color: #111827; color: #f3f4f6; }
        .match-schedule-container { max-width: 1000px; margin: 0 auto; padding: 0 1rem 3rem; }
        .league-title { font-size: 1rem; font-weight: 700; margin: 20px auto 15px; background: #1d4ed8; color: white; border-radius: 8px; text-align: center; padding: 12px; width: calc(100% - 1rem); max-width: 960px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .match-card { display: block; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; padding: 14px; margin: 16px auto; background: #ffffff; width: calc(100% - 1rem); max-width: 960px; transition: all 0.25s; text-decoration: none; }
        .dark .match-card { background: #374151; border-color: #4b5563; }
        .match-card:hover { border-color: #93c5fd; }
        .match-card-content { display: flex; flex-direction: column; gap: 6px; }
        .match-row-teams { display: flex; align-items: center; justify-content: space-between; width: 100%; gap: 8px; }
        .match-team { flex: 1; display: flex; align-items: center; gap: 8px; min-width: 0; flex-basis: 0; }
        .match-team.home { justify-content: flex-end; }
        .match-team.away { justify-content: flex-start; }
        .match-team img { width: 48px; height: 48px; flex-shrink: 0; }
        .match-team-name { font-size: 1.125rem; font-weight: 700; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dark .match-team-name { color: #f3f4f6; }
        .match-team.home .match-team-name { order: -1; text-align: right; }
        .match-center { flex-shrink: 0; min-width: 90px; text-align: center; }
        .match-local-time { font-size: 0.875rem; font-weight: 600; color: #4b5563; }
        .dark .match-local-time { color: #9ca3af; }
        .match-status { font-size: 0.75rem; font-weight: 700; padding: 4px 8px; border-radius: 9999px; display: inline-block; min-width: 60px; line-height: 1; }
        .match-status-countdown { background: #10b981; color: white; }
        .match-status-live { background: #ef4444; color: white; animation: pulse 1.2s infinite; }
        .match-status-over { background: #6b7280; color: white; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .match-league-bar { margin-top: 4px; padding: 6px 16px; background: rgba(29,78,216,0.1); border-radius: 8px; text-align: center; }
        .match-league-bar p { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #1d4ed8; letter-spacing: 0.6px; margin: 0; }
        .dark .match-league-bar { background: rgba(59,130,246,0.2); }
        .dark .match-league-bar p { color: #60a5fa; }
        @media (max-width: 640px) { .match-team-name { font-size: 0.875rem; white-space: normal; } .match-team img { width: 36px; height: 36px; } }
        header { position: fixed; top: 0; width: 100%; background: white; height: 70px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .dark header { background: #1f2937; }
        .toggle { position: relative; display: inline-block; width: 46px; height: 24px; }
        .toggle input { opacity: 0; width:0; height:0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #ccc; border-radius: 30px; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background: #3b82f6; }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Telegram Popup Styles */
        .tgx-popup-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.78); z-index: 2147483647; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .tgx-popup-box { background: linear-gradient(135deg, #0088cc, #006ba6); color: white; padding: 40px 30px; border-radius: 24px; text-align: center; max-width: 420px; width: 92%; position: relative; animation: tgxZoomIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .tgx-join-btn { display: inline-block; background: white; color: #0088cc; padding: 16px 44px; border-radius: 50px; text-decoration: none; font-weight: 700; margin-top: 20px; }
        .tgx-close-btn { position: absolute; top: 14px; right: 18px; color: white; font-size: 26px; cursor: pointer; border: none; background: transparent; }
        @keyframes tgxZoomIn { from { opacity: 0; transform: scale(0.6); } to { opacity: 1; transform: scale(1); } }
        .tgx-active { display: flex; }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5525538810839147" crossorigin="anonymous"></script>
</head>
<body>

<header>
    <div class="max-w-[1000px] mx-auto px-4 h-full flex justify-between items-center">
        <a href="https://www.yosin-tv.net/"><img src="https://web.cricfoot.net/logo.png" alt="YoSinTV" style="height:65px;"></a>
        <label class="toggle">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider"></span>
        </label>
    </div>
</header>

<main class="pt-[80px]">
    <center class="my-3">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5525538810839147" data-ad-slot="4345862479" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </center>

    <div class="match-schedule-container">
        <a href="/?ads=link" class="blinking-dot-container" style="display:inline-flex;align-items:center;gap:10px;font-family:Arial,sans-serif;font-size:16px;font-weight:bold;text-decoration:none;color:#333;transition:color 0.3s ease;width:100%;margin:0;padding:10px 0;text-align:center;box-sizing:border-box;border:2px solid #333;border-radius:10px;justify-content:center;" onmouseover="this.style.color='#ff0000'" onmouseout="this.style.color='#333'"><span style="width:10px;height:10px;background-color:red;border-radius:50%;animation:blink 1s infinite;"></span> Watch Football Matches: Click Here</a><style>@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style>        <h2 class="league-title">Upcoming Cricket Matches</h2>
        <div id="cricket-list"></div>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const list = document.getElementById('cricket-list');
    const toggle = document.getElementById('darkModeToggle');

    // Theme Logic
    if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
        toggle.checked = true;
    }
    toggle.addEventListener('change', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('darkMode', toggle.checked);
    });

    async function loadMatches() {
        try {
            const res = await fetch('https://yosintv-api.pages.dev/api/cricket.json');
            const data = await res.json();
            const rawMatches = data.matches || data;
            
            const now = Date.now();
            let processed = [];

            rawMatches.forEach(m => {
                const isTest = m.repeat === "5";
                const repeatDays = isTest ? 5 : 1;
                const durationMs = (parseInt(m.duration) || 6) * 3600000;
                const baseStart = new Date(m.start || m.match_time).getTime();

                let foundActiveDay = null;

                for (let i = 0; i < repeatDays; i++) {
                    const dStart = baseStart + (i * 86400000);
                    const dEnd = dStart + durationMs;

                    // If this day is LIVE or in the FUTURE, take it and stop searching
                    if (now < dEnd) {
                        foundActiveDay = { ...m };
                        foundActiveDay.start = new Date(dStart).toISOString();
                        // ONLY add Day label if it's a "5" repeat match
                        if (isTest) {
                            foundActiveDay.displayLeague = (m.competition || m.league || "") + ` (Day ${i+1})`;
                        } else {
                            foundActiveDay.displayLeague = m.competition || m.league || "";
                        }
                        break;
                    }
                }
                if (foundActiveDay) processed.push(foundActiveDay);
            });

            processed.sort((a, b) => new Date(a.start) - new Date(b.start));
            render(processed);

        } catch (e) {
            list.innerHTML = '<p class="text-center py-10 font-bold text-red-500">❌ Error loading matches...</p>';
        }
    }

    function render(matches) {
        list.innerHTML = matches.map((m, index) => {
            const startTime = m.start;
            const timeStr = new Date(startTime).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true });
            
            return `
                <a href="${m.details_url || '#'}" target="_blank" class="match-card">
                    <div class="match-card-content">
                        <div class="match-row-teams">
                            <div class="match-team home">
                                <p class="match-team-name">${m.team1}</p>
                                <img src="${m.team1_logo}" onerror="this.src='https://placehold.co/48'">
                            </div>
                            <div class="match-center">
                                <p class="match-local-time">${timeStr}</p>
                                <p class="match-status" data-time="${startTime}" data-duration="${m.duration || 6}">Loading...</p>
                            </div>
                            <div class="match-team away">
                                <img src="${m.team2_logo}" onerror="this.src='https://placehold.co/48'">
                                <p class="match-team-name">${m.team2}</p>
                            </div>
                        </div>
                        <div class="match-league-bar"><p>${m.displayLeague}</p></div>
                    </div>
                </a>
            `;
        }).join('');
        updateCountdowns();
    }

    function updateCountdowns() {
        const now = Date.now();
        document.querySelectorAll('.match-status').forEach(el => {
            const start = new Date(el.dataset.time).getTime();
            const end = start + (parseInt(el.dataset.duration) * 3600000);
            
            if (now >= end) {
                el.textContent = 'FINISHED';
                el.className = 'match-status match-status-over';
            } else if (now >= start) {
                el.textContent = 'LIVE';
                el.className = 'match-status match-status-live';
            } else {
                const diff = start - now;
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                el.textContent = h > 0 ? `${h}h ${m}m` : `${m}m`;
                el.className = 'match-status match-status-countdown';
            }
        });
    }

    setInterval(updateCountdowns, 60000);
    loadMatches();
</script>

<div class="tgx-popup-overlay" id="tgxPopup">
  <div class="tgx-popup-box">
    <button class="tgx-close-btn" onclick="closeTgxPopup()">×</button>
    <h2 class="text-2xl font-bold mb-2">Join YoSinTV Telegram</h2>
    <p>Match updates, news & highlights!</p>
    <a href="https://t.me/yosintvlive" target="_blank" class="tgx-join-btn">Click to Join Channel</a>
  </div>
</div>

<script>
  function closeTgxPopup() { document.getElementById('tgxPopup').classList.remove('tgx-active'); }
  window.onload = () => { setTimeout(() => { document.getElementById('tgxPopup').classList.add('tgx-active'); }, 2000); };
</script>

</body>
</html>
